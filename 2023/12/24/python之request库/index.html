<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="在复现一些web的CVE时，多会用到python脚本进行辅助攻击和利用，其中利用追到的无非就是requets库了。  requests库安装 使用pip install requests即可下载该库，使用import即可导入该库   在github上下载源码进行编译安装，执行以下命令：    12git clone git:&#x2F;&#x2F;github.com&#x2F;kennethreitz&#x2F;requests.">
<meta property="og:type" content="article">
<meta property="og:title" content="python之request库">
<meta property="og:url" content="http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/index.html">
<meta property="og:site_name" content="Recyvan">
<meta property="og:description" content="在复现一些web的CVE时，多会用到python脚本进行辅助攻击和利用，其中利用追到的无非就是requets库了。  requests库安装 使用pip install requests即可下载该库，使用import即可导入该库   在github上下载源码进行编译安装，执行以下命令：    12git clone git:&#x2F;&#x2F;github.com&#x2F;kennethreitz&#x2F;requests.">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/%7B5AC7B09C-6A33-47ca-A7CA-7ED7FD3C437D%7D.png">
<meta property="og:image" content="http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/%7B564A2C10-43D8-41dd-A44E-2963AE3415E9%7D.png">
<meta property="og:image" content="http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/%7B4C0D96C9-5CB1-4e89-A360-8983FA36E0E4%7D.png">
<meta property="og:image" content="http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/%7B013A0C66-5F41-4ed2-8574-0F03FEC04B27%7D.png">
<meta property="og:image" content="http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/%7BC9F2A256-A796-4f96-A6B2-F368BBE048BE%7D.png">
<meta property="article:published_time" content="2023-12-24T03:29:10.000Z">
<meta property="article:modified_time" content="2023-12-26T04:52:03.378Z">
<meta property="article:author" content="Recyvan">
<meta property="article:tag" content="网络安全，python">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/%7B5AC7B09C-6A33-47ca-A7CA-7ED7FD3C437D%7D.png">
    
    
      
        
          <link rel="shortcut icon" href="../../../../images/auto.jpg">
        
      
      
        
          <link rel="icon" type="image/png" href="../../../../images/auto.jpg" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="../../../../images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>python之request库</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="../../../../css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.1.1"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="顶部" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="../../../../index.html">首页</a></li><!--
     --><!--
       --><li><a href="../../../../archives/">归档</a></li><!--
     --><!--
       --><li><a href="../../../../about/">关于</a></li><!--
     --><!--
       --><li><a href="../../../../links/">links</a></li><!--
     --><!--
       --><li><a href="https://recyvan.github.io/">项目</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="../../27/%E5%85%B3%E4%BA%8Easpx%E6%96%87%E4%BB%B6%E5%92%8Cdll%E6%96%87%E4%BB%B6%E7%9A%84%E5%85%B3%E7%B3%BB%E7%9A%84%E5%AD%A6%E4%B9%A0/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="../../21/windows%E5%9F%9F%E4%B8%8E%E7%94%A8%E6%88%B7%E7%BB%84%E7%AD%96%E7%95%A5/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/&text=python之request库"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/&title=python之request库"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/&is_video=false&description=python之request库"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=python之request库&body=Check out this article: http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/&title=python之request库"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/&title=python之request库"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/&title=python之request库"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/&title=python之request库"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/&name=python之request库&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/&t=python之request库"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#requests%E5%BA%93"><span class="toc-number">1.</span> <span class="toc-text">requests库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E4%B8%80%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.</span> <span class="toc-text">单一命令使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%8F%82%E6%95%B0%E7%9A%84%E5%88%A9%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">返回参数的利用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ip%E4%BC%AA%E9%80%A0head%E5%A4%B4%E9%83%A8%E4%BC%AA%E9%80%A0"><span class="toc-number">3.</span> <span class="toc-text">ip伪造head头部伪造</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8IP%E4%BB%A3%E7%90%86%E6%B1%A0%E4%BC%AA%E8%A3%85IP"><span class="toc-number">3.1.</span> <span class="toc-text">使用IP代理池伪装IP</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BC%AA%E8%A3%85"><span class="toc-number">3.1.1.</span> <span class="toc-text">浏览器伪装</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%9A%E8%AF%9D%E4%BF%9D%E6%8C%81"><span class="toc-number">4.</span> <span class="toc-text">会话保持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD"><span class="toc-number">5.</span> <span class="toc-text">文件上传和下载</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">5.1.</span> <span class="toc-text">单文件上传</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">5.2.</span> <span class="toc-text">多文件上传</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD"><span class="toc-number">5.3.</span> <span class="toc-text">文件下载</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BC%A0%E5%8F%82"><span class="toc-number">6.</span> <span class="toc-text">命令行传参</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        python之request库
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Recyvan</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-12-24T03:29:10.000Z" class="dt-published" itemprop="datePublished">2023-12-24</time>
        
        (Updated: <time datetime="2023-12-26T04:52:03.378Z" class="dt-updated" itemprop="dateModified">2023-12-26</time>)
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="../../../../categories/python/">python</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="../../../../tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%EF%BC%8Cpython/" rel="tag">网络安全，python</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <hr>
<hr>
<p>在复现一些web的CVE时，多会用到python脚本进行辅助攻击和利用，其中利用追到的无非就是requets库了。</p>
<hr>
<h3 id="requests库"><a href="#requests库" class="headerlink" title="requests库"></a>requests库</h3><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><ul>
<li><p>使用pip install requests即可下载该库，使用import即可导入该库</p>
<p><img src="/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/%7B5AC7B09C-6A33-47ca-A7CA-7ED7FD3C437D%7D.png" alt="安装requets库"></p>
</li>
<li><p>在github上下载源码进行编译安装，执行以下命令：</p>
</li>
</ul>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone git://github.com/kennethreitz/requests.git</span><br><span class="line">python setup.py install</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="单一命令使用"><a href="#单一命令使用" class="headerlink" title="单一命令使用"></a>单一命令使用</h4><p>现在使用易优CMS进行演示</p>
<p>requests.get函数可以用来发送来发送http请求，并返回得到的数据包（默认保存在text文件中）。</p>
<p><img src="/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/%7B564A2C10-43D8-41dd-A44E-2963AE3415E9%7D.png" alt="相关安装"></p>
<p>当然上述命令用于发送get请求，参数可以直接拼接到url中，但如果post请求，则因该使用<code>request.post</code> 函数</p>
<p>在网站的后台登录出有post传参用户名和密码：</p>
<p><img src="/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/%7B4C0D96C9-5CB1-4e89-A360-8983FA36E0E4%7D.png" alt="后台登录"></p>
<p>一般大多情况下post传参使用application&#x2F;x-www-form-urlencoded格式，在requests中使用字典的格式被requests模块并传参。</p>
<p><img src="/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/%7B013A0C66-5F41-4ed2-8574-0F03FEC04B27%7D.png" alt="post传参登录"></p>
<p>当然reuquests还有PUT、DELETE等传参方式。</p>
<h3 id="返回参数的利用"><a href="#返回参数的利用" class="headerlink" title="返回参数的利用"></a>返回参数的利用</h3><p>调用 requests 请求之后，会返回一个 response 对象，该对象包含了具体的响应信息，如状态码、响应头、响应内容等。</p>
<table>
<thead>
<tr>
<th>返回类型</th>
<th>解释（具体含义）</th>
</tr>
</thead>
<tbody><tr>
<td>r.status_code</td>
<td>获得http中返回的状态码，可用于编写一些网页状态的脚本（如文件上传-条件竞争）</td>
</tr>
<tr>
<td>r.url</td>
<td>请求的最终地址（应是多见于30x的跳转</td>
</tr>
<tr>
<td>r.encoding</td>
<td>对于request返回的text文件的编码格式</td>
</tr>
<tr>
<td>r.reason</td>
<td>状态码的描述，例如404的Not Found 同r.status_code</td>
</tr>
<tr>
<td>r.content</td>
<td>返回的相应内容，且为byte类型</td>
</tr>
<tr>
<td>r.text</td>
<td>对于request返回的text文件</td>
</tr>
<tr>
<td>r.json</td>
<td>内置得JSON解码器</td>
</tr>
<tr>
<td>r.cookie</td>
<td>返回得cookie值</td>
</tr>
</tbody></table>
<h3 id="ip伪造head头部伪造"><a href="#ip伪造head头部伪造" class="headerlink" title="ip伪造head头部伪造"></a>ip伪造head头部伪造</h3><p>当然一个网站有时会对请求会检测请求的浏览器类型，ip地址等，这是会涉及到head头部伪造</p>
<h4 id="使用IP代理池伪装IP"><a href="#使用IP代理池伪装IP" class="headerlink" title="使用IP代理池伪装IP"></a>使用IP代理池伪装IP</h4><p>利于python中定义自己想要设置得ip地址：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">proxies = &#123;    <span class="string">&#x27;http&#x27;</span>:<span class="string">&#x27;http://xxx.xx.xx.xxx:xxx&#x27;</span>,    </span><br><span class="line">				.... </span><br><span class="line">			   <span class="string">&#x27;http&#x27;</span>:<span class="string">&#x27;http://xx.xxx.xxx.xxx:xxxx&#x27;</span>,</span><br><span class="line">		  &#125;</span><br><span class="line">response = requests.get(url,proxies=proxies)</span><br></pre></td></tr></table></figure>
<p>对于代理ip的获取，可以使用python爬取免费的且可爬取的代理ip例如在github上一个开源的代理IP地址**<a target="_blank" rel="noopener" href="https://github.com/Python3WebSpider/ProxyPool">ProxyPool</a>** ，通过如下代码获取代理IP</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">proxy_pool_url = <span class="string">&#x27;http://localhost:5555/random&#x27;</span> <span class="comment">#项目获取代理代理IP的本地网址</span></span><br><span class="line"><span class="comment"># 获取代理</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_proxy</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(proxy_pool_url)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>: </span><br><span class="line">            <span class="keyword">return</span> response.text <span class="comment"># 返回的内容为代理IP</span></span><br><span class="line">    <span class="keyword">except</span> ConnectionError:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">real_proxy = <span class="string">&#x27;http://&#x27;</span> + get_proxy()</span><br></pre></td></tr></table></figure>

<h5 id="浏览器伪装"><a href="#浏览器伪装" class="headerlink" title="浏览器伪装"></a>浏览器伪装</h5><p>大多User-Agent值可以通过开发者工具（F12）获取到比如常见的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests   </span><br><span class="line">headers=&#123;<span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36</span></span><br><span class="line"><span class="string">&#x27;</span>&#125;  <span class="comment">#模拟Chrome浏览器  </span></span><br><span class="line">response = requests.get(<span class="string">&quot;http://www.baidu.com&quot;</span>,headers=headers) </span><br></pre></td></tr></table></figure>

<p><img src="/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/%7BC9F2A256-A796-4f96-A6B2-F368BBE048BE%7D.png" alt="user-Agent模拟"></p>
<blockquote>
<p>对于一些网站对于访问速率(频次)的限制，可以使用一个time库中的sleep进行延迟发送，当然更加逼真的话可以使用random库中的random()函数来生成随机数进行变频访问</p>
</blockquote>
<h3 id="会话保持"><a href="#会话保持" class="headerlink" title="会话保持"></a>会话保持</h3><p>大多数网站是通过session对象跨请求保持某些参数，即保持登陆状态，官方的说就是你使用requests尝试登录并且验证成功，服务端会返回一些Cookie，这些Cookie可以使你的下次请求不需要验证，而Session对象能保持这些Cookie，而不用你每次提交请求时构建一个新的Cookie。</p>
<p>例如使用<code>rs = requests.Session()</code> 来打开会话，在获取返回结果时用<code>restult = session.post/get()</code>。利用在登录一个post传参的网站时，可以使用如下代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">rs = requests.session() <span class="comment">#建立会话</span></span><br><span class="line">data =&#123;</span><br><span class="line">   <span class="string">&#x27;usename&#x27;</span>: <span class="string">&#x27;xxxxxx&#x27;</span>, </span><br><span class="line">   <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;xxxxx&#x27;</span>   </span><br><span class="line">&#125;</span><br><span class="line">url =<span class="string">&quot;https://passport.xx.com/user/login&quot;</span> <span class="comment"># 登录url地址</span></span><br><span class="line">restult = session.post(url,data=data) <span class="comment">#不再使用request而是session</span></span><br><span class="line"></span><br><span class="line">url2 = <span class="string">&quot;https://xx.com/ck/shopping/id/235667&quot;</span><span class="comment"># 再次请求 登录后的网站获取数据</span></span><br><span class="line">result_data =  session.get(url2)</span><br><span class="line"><span class="built_in">print</span>(result_data.json()[<span class="string">&#x27;data&#x27;</span>])</span><br></pre></td></tr></table></figure>

<h3 id="文件上传和下载"><a href="#文件上传和下载" class="headerlink" title="文件上传和下载"></a>文件上传和下载</h3><p>对于一些CVE脚本会进行一些文件上传的操作(如上传一句木马)，但这是并不是htnl代码般浏览器访问选择文件然后上传。以post方式（表单）上传多是先将二进制文件读取到内存中，再将内存中的文件发送到服务器保存。</p>
<h4 id="单文件上传"><a href="#单文件上传" class="headerlink" title="单文件上传"></a>单文件上传</h4><p>例如下列代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">fo = <span class="built_in">open</span>(<span class="string">&quot;shell.php&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="comment"># 打开一个文件,其中‘w’为创建或覆盖文件，‘a’用于追写文件内容，‘xb’为以二进制方式打开，x为读写模式，‘r’为只读该文件 </span></span><br><span class="line">fo.write( <span class="string">&quot;&lt;?php phpinfo(); ?&gt;&quot;</span>) <span class="comment"># 关闭打开的文件</span></span><br><span class="line">fo.close()</span><br><span class="line"></span><br><span class="line">files &#123;<span class="string">&#x27;file1&#x27;</span>:<span class="built_in">open</span>(<span class="string">&#x27;shell.php&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="string">&#x27;image/png&#x27;</span>&#125; <span class="comment">#上传文件以二进制方式上传.&#x27;image/png&#x27;为上传类型，可以不指定</span></span><br><span class="line">response requests.post(<span class="string">&#x27;http://www.hackxxx.com/upload.php&#x27;</span>,files=files)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>

<h4 id="多文件上传"><a href="#多文件上传" class="headerlink" title="多文件上传"></a>多文件上传</h4><p>多文件上传同于单文件上传，只需修改一下file参数即可：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">files &#123;(<span class="string">&#x27;file1&#x27;</span>,(<span class="string">&#x27;shell1.php&#x27;</span><span class="built_in">open</span>(<span class="string">&#x27;shell1.php&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>),<span class="string">&#x27;image/png&#x27;</span>))</span><br><span class="line">       (<span class="string">&#x27;file2&#x27;</span>,(<span class="string">&#x27;shell2.php&#x27;</span><span class="built_in">open</span>(<span class="string">&#x27;shell2.php&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>),<span class="string">&#x27;image/jpeg&#x27;</span>))</span><br><span class="line">       (<span class="string">&#x27;file3&#x27;</span>,(<span class="string">&#x27;shell3.php&#x27;</span><span class="built_in">open</span>(<span class="string">&#x27;shell3.php&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>),<span class="string">&#x27;image/png&#x27;</span>))</span><br><span class="line">      &#125;  <span class="comment">#这里同样可以指定或不指定文件名称和文件类型，不指定文件名称应该是以打开文件名称作为文件名</span></span><br></pre></td></tr></table></figure>

<p>其实还有以流的方式上传和监听时上传(requests-toolbet),但还未学习。</p>
<h4 id="文件下载"><a href="#文件下载" class="headerlink" title="文件下载"></a>文件下载</h4><p>对于较小文件可以直接利用写的操作完成：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">req = requests.get(<span class="string">&quot;http://www.hackxxx.com//shell.jpg&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&quot;c:\shell.jpg&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f: <span class="comment">#以二进制方式打开</span></span><br><span class="line">    f.write(req.content)</span><br></pre></td></tr></table></figure>

<p>当 Python 写入文件时，会将数据暂存在内存中，直至缓存存满后才真正写入文件。如果需要写入的数据很大，可能会导致内存不足。因此对于大文件的下载，可以采取分块读写的方法，每次只读写一小块。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">req = requests.get(<span class="string">&quot;http://www.hackxxx.com//shell.jpg&quot;</span>, stream=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&quot;c:\shell.jpg&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> chunk <span class="keyword">in</span> req.iter_content(chunk_size=<span class="number">1024</span>):  <span class="comment"># 每次加载1024字节</span></span><br><span class="line">        f.write(chunk)</span><br></pre></td></tr></table></figure>

<ul>
<li>这里with会自动判断是否关闭文件，所以不用在写<code>f.close()</code> 函数了。但浏览一些网上文章显示后讲到会遇到文件关闭后在一直占用进程，可能与部署的应用和版本有关吧？</li>
</ul>
<h3 id="命令行传参"><a href="#命令行传参" class="headerlink" title="命令行传参"></a>命令行传参</h3><p>大多脚本都时在cmd&#x2F;bash下进行命令行传参，这样方便管理和使用。在传参是多会用到<code>if __name__ == &quot;__main__&quot;:</code>函数</p>
<p>python属于脚本语言，同于php语言，对代码是逐句解释运行，一直从首行运行到尾行，这样会出现一些函数需要在特定条件下执行而无法被提前或滞后执行。而<code>if __name__ == &quot;__main__&quot;:</code>可以作为程序入口进行选择性执行一些函数。但它与C语言中的mian()不同的是可以多个文件中出现。</p>
<p>对于cmd中的参数，会使用到sys库中的argv，但要注意到是argv本身为一个数组，接受的一个了参数（argv[0]）是文件本身的名称，因此cmd下执行时第一个参数接受代码应为：<code>sys.argv[1]</code></p>
<p>例如以前的在upload-lab中条件竞争模块使用的脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## shell.py</span></span><br><span class="line"><span class="comment">## @Author : recyvan</span></span><br><span class="line"><span class="comment">## @Time : 2023-12-22</span></span><br><span class="line"><span class="comment">## #Description : upload-lab pass-17.</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">re</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        req=requests.get(url)</span><br><span class="line">        headers = &#123;<span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36&#x27;</span>,</span><br><span class="line">                   <span class="string">&#x27;Cookie&#x27;</span>: <span class="string">&#x27;session=eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiYWRtaW4ifQ.ZYY6_w.x_AGwnOGnXqmNAIWoT4Mi4Q68HU&#x27;</span>&#125;</span><br><span class="line">        reqcode=req.status_code</span><br><span class="line">        <span class="keyword">if</span> reqcode == <span class="number">200</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;uopload success！&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(reqcode)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    url=sys.argv[<span class="number">1</span>] </span><br><span class="line">    re(url)</span><br></pre></td></tr></table></figure>

<p>例如执行python shell.py -u <a target="_blank" rel="noopener" href="http://127.0.0.1/xxx/shell.php">http://127.0.0.1/xxx/shell.php</a> 执行后 url等于“ <a target="_blank" rel="noopener" href="http://127.0.0.1/xxx/shell.php%E2%80%9D%E3%80%82">http://127.0.0.1/xxx/shell.php”。</a></p>
<hr>
<p>关于其他脚本的学习（类，函数定义，列表，库等）学习后单独更新。</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="../../../../index.html">首页</a></li>
        
          <li><a href="../../../../archives/">归档</a></li>
        
          <li><a href="../../../../about/">关于</a></li>
        
          <li><a href="../../../../links/">links</a></li>
        
          <li><a href="https://recyvan.github.io/">项目</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#requests%E5%BA%93"><span class="toc-number">1.</span> <span class="toc-text">requests库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E4%B8%80%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.</span> <span class="toc-text">单一命令使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%8F%82%E6%95%B0%E7%9A%84%E5%88%A9%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">返回参数的利用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ip%E4%BC%AA%E9%80%A0head%E5%A4%B4%E9%83%A8%E4%BC%AA%E9%80%A0"><span class="toc-number">3.</span> <span class="toc-text">ip伪造head头部伪造</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8IP%E4%BB%A3%E7%90%86%E6%B1%A0%E4%BC%AA%E8%A3%85IP"><span class="toc-number">3.1.</span> <span class="toc-text">使用IP代理池伪装IP</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BC%AA%E8%A3%85"><span class="toc-number">3.1.1.</span> <span class="toc-text">浏览器伪装</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%9A%E8%AF%9D%E4%BF%9D%E6%8C%81"><span class="toc-number">4.</span> <span class="toc-text">会话保持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD"><span class="toc-number">5.</span> <span class="toc-text">文件上传和下载</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">5.1.</span> <span class="toc-text">单文件上传</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">5.2.</span> <span class="toc-text">多文件上传</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD"><span class="toc-number">5.3.</span> <span class="toc-text">文件下载</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BC%A0%E5%8F%82"><span class="toc-number">6.</span> <span class="toc-text">命令行传参</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/&text=python之request库"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/&title=python之request库"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/&is_video=false&description=python之request库"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=python之request库&body=Check out this article: http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/&title=python之request库"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/&title=python之request库"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/&title=python之request库"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/&title=python之request库"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/&name=python之request库&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://recyvan.github.io/2023/12/24/python%E4%B9%8Brequest%E5%BA%93/&t=python之request库"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2022-2024
    Recyvan
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="../../../../index.html">首页</a></li><!--
     --><!--
       --><li><a href="../../../../archives/">归档</a></li><!--
     --><!--
       --><li><a href="../../../../about/">关于</a></li><!--
     --><!--
       --><li><a href="../../../../links/">links</a></li><!--
     --><!--
       --><li><a href="https://recyvan.github.io/">项目</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板！\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功！");
      e.clearSelection();
    })
  })
  </script>


<script src="../../../../js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
